<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nudge</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="popup.css" />
    <link rel="stylesheet" href="../utils/error-feedback.css" />
    <link rel="stylesheet" href="../utils/loading-styles.css" />
  </head>
  <body>
    <div class="container">
      <!-- Header Section -->
      <header class="header">
        <h1 class="title">Nudge</h1>
        <!-- <button class="settings-btn" id="settingsBtn" aria-label="Settings">
          ‚öôÔ∏è
        </button> -->
      </header>

      <!-- Feature Grid Navigation -->
      <nav class="feature-grid">
        <button
          class="feature-btn"
          data-feature="break-reminder"
          id="breakReminderBtn"
        >
          <span class="feature-icon">‚è∞</span>
          <span class="feature-label">Break Reminder</span>
        </button>
        <button
          class="feature-btn"
          data-feature="focus-tracking"
          id="focusTrackingBtn"
        >
          <span class="feature-icon">üéØ</span>
          <span class="feature-label">Focus Tracking</span>
        </button>
        <button class="feature-btn" data-feature="pomodoro" id="pomodoroBtn">
          <span class="feature-icon">üçÖ</span>
          <span class="feature-label">Pomodoro</span>
        </button>
        <button class="feature-btn" data-feature="breathing" id="breathingBtn">
          <span class="feature-icon">ü´Å</span>
          <span class="feature-label">Breathing Technique</span>
        </button>
        <button
          class="feature-btn"
          data-feature="task-breakdown"
          id="taskBreakdownBtn"
        >
          <span class="feature-icon">üìù</span>
          <span class="feature-label">Task Breakdown</span>
        </button>
        <button class="feature-btn" data-feature="calendar" id="calendarBtn">
          <span class="feature-icon">üìÖ</span>
          <span class="feature-label">Calendar</span>
        </button>
        <button
          class="feature-btn"
          data-feature="white-noise"
          id="whiteNoiseBtn"
        >
          <span class="feature-icon">üîä</span>
          <span class="feature-label">White Noise</span>
        </button>
        <a class="feature-btn"  href="../external-pages/asmr-fidget.html" target="_blank"><button class="custombtn" data-feature="asmr-toys" id="asmrToysBtn">
          <span class="feature-icon">üéµ</span>
          <span class="feature-label">ASMR Toys</span>
        </button></a>
        <a class="feature-btn"  href="../external-pages/focus-anxiety.html" target="_blank"><button
          class="custombtn"
          data-feature="wellness-tools"
          id="wellnessToolsBtn"
        >
          <span class="feature-icon">üßò</span>
          <span class="feature-label">Wellness Tools</span>
        </button></a>
      </nav>

      <!-- Feature Content Panels -->
      <div class="feature-content">
        <!-- Home Panel (Default) -->
        <div class="feature-panel active" id="homePanel">
          <div class="welcome-message">
            <h2>Welcome to Focus Productivity</h2>
            <p>
              Select a feature above to get started with your productivity
              journey.
            </p>

            <div class="quick-stats">
              <div class="stat-card">
                <div class="stat-icon">‚è∞</div>
                <div class="stat-info">
                  <div class="stat-value" id="todayScreenTime">0m</div>
                  <div class="stat-label">Screen Time Today</div>
                </div>
              </div>
              <div class="stat-card">
                <div class="stat-icon">üçÖ</div>
                <div class="stat-info">
                  <div class="stat-value" id="todayPomodoros">0</div>
                  <div class="stat-label">Pomodoros Today</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Break Reminder Panel -->
        <div class="feature-panel" id="breakReminderPanel">
          <div class="panel-header">
            <h2>Break Reminder</h2>
            <span class="current-time" id="currentTime">0m</span>
          </div>
          <div class="panel-content">
            <!-- Break Status Display -->
            <div class="break-status" id="breakStatus" style="display: none;">
              <div class="break-info">
                <span class="break-type" id="breakType">Short Break</span>
                <span class="break-time-remaining" id="breakTimeRemaining">5:00</span>
              </div>
              <div class="break-controls">
                <button class="btn btn-small btn-secondary" id="endBreakBtn">
                  End Break Early
                </button>
              </div>
            </div>
            
            <!-- Work Timer Controls (shown when not on break) -->
            <div class="work-controls" id="workControls">
              <div class="time-limit-control">
                <label for="timeLimitInput">Break reminder after:</label>
                <div class="input-group">
                  <input
                    type="number"
                    id="timeLimitInput"
                    min="5"
                    max="180"
                    value="30"
                    title="Set break reminder time (5-180 minutes)"
                  />
                  <span>minutes</span>
                </div>
              </div>
              <div class="screen-time-controls">
                <button
                  class="btn btn-secondary"
                  id="takeBreakBtn"
                  title="Start a break manually"
                >
                  Take Break Now
                </button>
                <button
                  class="btn btn-small"
                  id="resetScreenTimeBtn"
                  title="Clear all screen time data"
                >
                  Reset Data
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Focus Tracking Panel -->
        <div class="feature-panel" id="focusTrackingPanel">
          <div class="panel-header">
            <h2>Focus Tracking</h2>
            <div class="focus-status-indicator" id="focusStatusIndicator">
              <span class="status-dot" id="focusStatusDot"></span>
              <span class="status-text" id="focusStatusText">Not Active</span>
            </div>
          </div>
          <div class="panel-content">
            <div class="focus-tab-display">
              <span class="focus-label">Focus Tab:</span>
              <span class="focus-url" id="focusUrl">Not set</span>
            </div>

            <div
              class="focus-session-info"
              id="focusSessionInfo"
              style="display: none"
            >
              <div class="session-stat">
                <span class="stat-label">Session Time:</span>
                <span class="stat-value" id="focusSessionTime">0m</span>
              </div>
              <div class="session-stat">
                <span class="stat-label">Deviations:</span>
                <span class="stat-value" id="focusDeviationCount">0</span>
              </div>
              <div class="session-stat">
                <span class="stat-label">Last Reminder:</span>
                <span class="stat-value" id="lastFocusReminder">Never</span>
              </div>
            </div>

            <div class="focus-controls">
              <button class="btn btn-secondary" id="setFocusBtn">
                Set Current Tab as Focus
              </button>
              <button class="btn btn-small" id="resetFocusBtn">Reset</button>
            </div>

            <div
              class="focus-deviation-history"
              id="focusDeviationHistory"
              style="display: none"
            >
              <h4 class="history-title">Recent Deviations</h4>
              <div class="deviation-list" id="deviationList">
                <!-- Deviation items will be populated here -->
              </div>
              <button class="btn btn-small btn-text" id="toggleHistoryBtn">
                Show History
              </button>
            </div>
          </div>
        </div>

        <!-- Pomodoro Panel -->
        <div class="feature-panel" id="pomodoroPanel">
          <div class="panel-header">
            <h2>Pomodoro Timer</h2>
          </div>
          <div class="panel-content">
            <div id="pomodoroContainer">
              <!-- Pomodoro Timer component will be rendered here -->
            </div>
          </div>
        </div>

        <!-- Breathing Technique Panel -->
        <div class="feature-panel" id="breathingPanel">
         
          <div class="panel-content">
           
            <div class="breathing-controls">
              <button style="display: none;" class="transpbtn" id="startBreathingBtn">
                
              </button>
            </div>
            <!-- <div class="breathing-options">
              <h3>Breathing Techniques</h3>
              <div class="technique-grid">
                <button class="technique-btn" data-technique="4-7-8">
                  <span class="technique-name">4-7-8 Breathing</span>
                  <span class="technique-desc">Relaxation technique</span>
                </button>
                <button class="technique-btn" data-technique="box">
                  <span class="technique-name">Box Breathing</span>
                  <span class="technique-desc">Focus and calm</span>
                </button>
              </div>
            </div> -->
          </div>
        </div>

        <!-- Task Breakdown Panel -->
        <div class="feature-panel" id="taskBreakdownPanel">
          <div class="panel-header">
            <h2>AI Task Breakdown</h2>
          </div>
          <div class="panel-content">
            <div class="task-input-group">
              <input
                type="text"
                id="taskNameInput"
                placeholder="Enter task name"
                class="task-input"
              />
              <input
                type="datetime-local"
                id="taskDeadlineInput"
                class="task-input"
              />
            </div>
            <button class="btn btn-primary" id="getBreakdownBtn">
              Get AI Breakdown
            </button>
            <div
              class="task-breakdown"
              id="taskBreakdown"
              style="display: none"
            >
              <h3>Task Breakdown:</h3>
              <ul id="breakdownList"></ul>
            </div>
          </div>
        </div>

        <!-- Calendar Panel -->
        <div class="feature-panel" id="calendarPanel">
          <div class="panel-header">
            <h2>Calendar Integration</h2>
            <div
              class="calendar-connection-status"
              id="calendarConnectionStatus"
            >
              <span class="connection-dot" id="connectionDot"></span>
              <span class="connection-text" id="connectionText"
                >Not Connected</span
              >
            </div>
          </div>
          <div class="panel-content">
            <!-- Calendar Configuration Panel -->
            <div
              class="calendar-config"
              id="calendarConfig"
              style="display: none"
            >
              <div class="config-header">
                <h4>API Configuration</h4>
                <button class="btn btn-small btn-text" id="toggleConfigBtn">
                  Show Setup
                </button>
              </div>
              <div
                class="config-content"
                id="configContent"
                style="display: none"
              >
                <div class="config-input-group">
                  <label for="apiKeyInput">Google Calendar API Key:</label>
                  <input
                    type="password"
                    id="apiKeyInput"
                    placeholder="Enter your API key"
                    class="config-input"
                  />
                </div>
                <div class="config-input-group">
                  <label for="accessTokenInput">OAuth Access Token:</label>
                  <input
                    type="password"
                    id="accessTokenInput"
                    placeholder="Enter your access token"
                    class="config-input"
                  />
                </div>
                <div class="config-actions">
                  <button class="btn btn-primary btn-small" id="saveConfigBtn">
                    Save Configuration
                  </button>
                  <button
                    class="btn btn-secondary btn-small"
                    id="testConnectionBtn"
                  >
                    Test Connection
                  </button>
                  <button class="btn btn-small" id="clearConfigBtn">
                    Clear
                  </button>
                </div>
                <div class="setup-instructions" id="setupInstructions">
                  <h5>Setup Instructions:</h5>
                  <ol>
                    <li>
                      Go to
                      <a href="https://console.cloud.google.com" target="_blank"
                        >Google Cloud Console</a
                      >
                    </li>
                    <li>Create a new project or select existing project</li>
                    <li>Enable the Google Calendar API</li>
                    <li>Create credentials (API Key and OAuth 2.0)</li>
                    <li>Configure OAuth consent screen</li>
                    <li>Add your credentials above and test connection</li>
                  </ol>
                </div>
              </div>
            </div>

            <!-- Task Reminder Creation Form -->
            <div class="calendar-reminder-form" id="calendarReminderForm">
              <div class="reminder-input-group">
                <input
                  type="text"
                  id="reminderTaskInput"
                  placeholder="Task name (or use task from above)"
                  class="reminder-input"
                />
                <input
                  type="datetime-local"
                  id="reminderDeadlineInput"
                  class="reminder-input"
                />
              </div>
              <div class="priority-and-create">
                <select id="prioritySelect" class="priority-select">
                  <option value="high">High Priority (4 reminders)</option>
                  <option value="medium" selected>
                    Medium Priority (3 reminders)
                  </option>
                  <option value="low">Low Priority (3 reminders)</option>
                </select>
                <button class="btn btn-primary" id="createRemindersBtn">
                  Create Calendar Reminders
                </button>
              </div>
              <div class="priority-info" id="priorityInfo">
                <small
                  >Medium Priority: Reminders at 3 days, 1 day, and 4 hours
                  before deadline</small
                >
              </div>
            </div>

            <!-- Manual Reminder Fallback -->
            <div
              class="manual-reminder-fallback"
              id="manualReminderFallback"
              style="display: none"
            >
              <div class="fallback-header">
                <h4>Manual Reminder Creation</h4>
                <p>
                  Calendar integration unavailable. Use these reminder times:
                </p>
              </div>
              <div class="manual-reminder-list" id="manualReminderList">
                <!-- Manual reminder times will be populated here -->
              </div>
              <div class="fallback-actions">
                <button
                  class="btn btn-secondary btn-small"
                  id="copyRemindersBtn"
                >
                  Copy to Clipboard
                </button>
                <button class="btn btn-small" id="hideManualBtn">Hide</button>
              </div>
            </div>

            <!-- Calendar Status Display -->
            <div class="calendar-status" id="calendarStatus"></div>
          </div>
        </div>

        <!-- White Noise Panel -->
        <div class="feature-panel" id="whiteNoisePanel">
          <div class="panel-header">
            <h2>White Noise</h2>
          </div>
          <div class="panel-content">
            <div class="audio-control">
              <button
                class="btn btn-wellness toggle-btn btn-large"
                id="whiteNoiseToggleBtn"
              >
                <span class="icon">üîä</span>
                <span>Toggle White Noise</span>
              </button>
              <div
                class="audio-controls"
                id="audioControls"
                style="display: none"
              >
                <div class="volume-control">
                  <label for="volumeSlider">Volume:</label>
                  <input
                    type="range"
                    id="volumeSlider"
                    min="0"
                    max="100"
                    value="50"
                    class="volume-slider"
                  />
                  <span id="volumeValue" class="volume-value">50%</span>
                </div>
                <button class="btn btn-small" id="nextSoundBtn">
                  <span class="icon">üîÄ</span>
                  <span>Next Sound</span>

                </button>
                <div class="current-sound-display">
                  
                  <span class="sound-label">Playing:</span>
                  <span id="currentSoundName" class="sound-name">None</span>
                </div>
                <span><button  class="btn" id="backgroundBtn">Play in Background</button>
                </span>
              </div>
            </div>

            
          </div>
        </div>

     
      <!-- Break Type Selection Modal -->
      <div class="modal" id="breakTypeModal" style="display: none">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Choose Break Type</h3>
            <button class="close-btn" id="closeBreakTypeBtn">&times;</button>
          </div>
          <div class="break-type-container">
            <div class="break-type-options">
              <button class="break-type-btn" data-break-type="short" data-duration="5">
                <span class="break-type-icon">‚è±Ô∏è</span>
                <span class="break-type-label">Short Break</span>
                <span class="break-type-duration">5 minutes</span>
              </button>
              <button class="break-type-btn" data-break-type="medium" data-duration="15">
                <span class="break-type-icon">‚è∞</span>
                <span class="break-type-label">Medium Break</span>
                <span class="break-type-duration">15 minutes</span>
              </button>
              <button class="break-type-btn" data-break-type="long" data-duration="30">
                <span class="break-type-icon">üïê</span>
                <span class="break-type-label">Long Break</span>
                <span class="break-type-duration">30 minutes</span>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Breathing Exercise Modal -->
      <div class="modal" id="breathingModal" style="display: none">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Breathing Exercise</h3>
            <button class="close-btn" id="closeBreathingBtn">&times;</button>
          </div>
          <div class="breathing-container">
            <div class="breathing-circle" id="breathingCircle"></div>
            <div class="breathing-text" id="breathingText">
              Click Start to begin
            </div>
            <div class="breathing-controls">
              <button class="btn btn-primary" id="startBreathingModalBtn">
                Start
              </button>
              <button
                class="btn btn-secondary"
                id="stopBreathingBtn"
                style="display: none"
              >
                Stop
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="../utils/error-handler.js"></script>
    <script src="../utils/lazy-loader.js"></script>
    <script src="../utils/accessibility.js"></script>
    <script src="../services/storage-manager.js"></script>
    <script src="../services/break-timer-manager.js"></script>
    <script src="../services/break-notification-system.js"></script>
    <script src="../services/pomodoro-service.js"></script>
    <script src="../services/gemini-service.js"></script>
    <script src="../services/calendar-service.js"></script>
    <script src="../utils/constants.js"></script>
    <script src="components/task-manager.js"></script>
    <script src="components/pomodoro-timer.js"></script>
    <script src="components/breathing-exercise.js"></script>
    <script src="popup.js"></script>
  </body>
</html>
